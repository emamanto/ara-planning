#!/bin/bash

ID=-1
COLOR=none
XDROP=0
YDROP=0
REBUILD=no
RESET=no

while getopts ":i:c:x:y:br" opt; do
case $opt in
    i)
      ID=$OPTARG
      ;;
    c)
      COLOR=$OPTARG
      ;;
    x)
      XDROP=$OPTARG
      ;;
    y)
      YDROP=$OPTARG
      ;;
    b)
      REBUILD=yes
      ;;
    r)
      RESET=yes
      ;;
    \?)
      echo "Invalid flag: -$OPTARG"
      exit
      ;;
    :)
      echo "Flag requires argument: -$OPTARG"
      exit
      ;;
esac
done

if [ $COLOR = none ]; then
    if [ $ID = -1 ]; then
	echo "Target object not specified"
	exit
    fi
else
    if [ $ID != -1 ]; then
	echo "Potentially conflicting object requests"
	exit
    fi
fi


if [ $REBUILD = yes ]; then
    make build_exp
    if [ $? != 0 ]; then
	echo "Compilation error"
	exit
    fi
fi

if [ $RESET = yes ]; then
    bin/experiment -r -i "$ID" -c "$COLOR" -x "$XDROP" -y "$YDROP"
else
    bin/experiment -i "$ID" -c "$COLOR" -x "$XDROP" -y "$YDROP"
fi

